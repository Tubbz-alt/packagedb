<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xml:lang="en" lang="en">
  <xi:include href="layout.html" />

  <head>
    <script type="text/javascript"
            src="${tg.url('/static/js/dojo/dojo.js')}"
            djConfig="parseOnLoad: true" >
    </script>
    <script type="text/javascript">
      dojo.require("dojo.parser");
      dojo.require("dojo.fx");
      dojo.require("dijit._base.manager");
      dojo.require("dijit.layout.ContentPane" );
      dojo.require("dijit.form.ValidationTextBox");
      dojo.require("dijit.form.Textarea");
      dojo.require("dijit.form.Form");
      dojo.require("dijit.form.Button");
    </script>

    <script type="text/javascript">
      function jump(page,form){
           urlparts = page.split('?_csrf');
           window.location = urlparts[0] + document.forms.namedItem(form).searchwords.value + '?_csrf'+urlparts[1];
           return false
      };

      function showTagForm() {
            var e = dojo.byId('tagFormContainer');
            if(e.style.display=="none") {
                dojo.fx.wipeIn({node: 'tagFormContainer',duration: 100}).play();
            }
            
      }

      function hideTagForm() {
            var e = dojo.byId('tagFormContainer');
            if(e.style.display!="none") {
                dojo.fx.wipeOut({node: 'tagFormContainer',duration: 100}).play();
            }
            
      }

      function toggle(hiddenId,buttonId){
           e = dojo.byId(hiddenId);
           but = dojo.byId(buttonId);
           if(e.style.display=="none") {
             e.style.display="";
             but.innerHTML="(less)";
           } else {
             e.style.display="none";
             but.innerHTML="(more)";
           }
      };

      function tagComment(formId, loaderId, destinationId){
          var form = dijit.byId(formId);
          dojo.connect(form, "onSubmit", function(e){
              e.preventDefault();
              if(form.isValid()){
                  dojo.fadeIn({
                      node: loaderId,
                      duration: 2000
                  }).play();
                  dojo.xhrPost( {
                      form: formId,
                      handleAs: "text",
                      load: function(response){
                                dojo.fadeOut({
                                    node: loaderId,
                                    duration: 1000
                                    }).play();
                                var form = dojo.query('#'+formId)[0];
                                form.reset();
                                var textarea = dojo.query('#'+formId+' textarea')[0];
                                if (textarea) {
                                    textarea.value="";
                                }
                                var dest = dojo.byId(destinationId);
                                dest.innerHTML = response;
                                }
                      });
                  }
              });
      };
    </script>
    <script type="text/javascript">
    dojo.addOnLoad(function(){
          tagComment("tagForm", "tagLoader", "tagList");
          tagComment("commentForm", "commentLoader", "commentList");
      });
    </script>
  </head>
  <body>

  <div id="info-bar" style="float:right; width: 220px;">
     Screenshot
     <div class="info-box">
       <h4>Application Info</h4>
         <div id="tagList">
           <xi:include href="_tags.html" />
         </div>
         <div class="group-header">
           <span class="title">Packages</span>
         </div>
         <div class="group-data">totem</div>
     </div>

    <br />
    Related stuff
  </div>
  <div id="main-pannel" style="margin-right: 235px;">
    <py:choose test="app.icon">
    <img py:when="None" style="float:left;padding-right:10px;" src="${tg.url('/static/images/noicon.png')}" />
    <img py:otherwise="True" style="float:left;padding-right:10px;" src="${tg.url('/static/images/totem.png')}" />
    </py:choose>
    <div style="margin-left:150;">
        <h2 style="color: #337acc;">${app.name}</h2>
        ${app.summary}
    </div>

    <p>
    Something | <a href="#user_comments"><img style="padding-right:5px;" src="${tg.url('/static/images/comments_small.png')}" />User Comments</a>
    </p>

    <p>
    ${app.description}
    </p>
    <p>
    User ratings
    </p>
    <div id="commentList">
      <xi:include href="_comments.html" />
    </div>
  </div>


  </body>
</html>
