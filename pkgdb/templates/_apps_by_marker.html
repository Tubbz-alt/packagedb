<html xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">
  <div py:def="_apps_by_marker(data_url='', marker_type='')" >
    <script type="text/javascript">
        function hide_all(){
            dojo.query('#apps-marker-list li').style("display", "none");
        }

        function filter_markers(pattern) {
            if (pattern.search(/^\^/) != 0) {
                pattern = '.*'+pattern;
            }
            else {
                pattern = pattern.slice(1);
            }
            var pat = new RegExp('^marker-'+pattern+'.*', 'i');
            dojo.query('#apps-marker-list li')
            .forEach(
                function f(x) {
                    if(x.id.search(pat) == 0) {
                        x.style.display = '';
                    }
                    else {
                        x.style.display = 'none';
                    }
                });
        }

        function switch_navi(target) {
            
            dojo.query('#'+target.parentNode.parentNode.id+' li')
                .removeClass('selected');

            dojo.query(target.parentNode).addClass('selected');

            if (target.nodeName != 'INPUT') {
                dojo.query('#'+target.parentNode.parentNode.id+' input')
                    .forEach("item.value='';");
            }

        }

        function load_apps(marker, target_id) {
            dojo.xhrGet( {
                url: "${data_url}".replace('/?', '/'+marker+'/?'),
                handleAs: "text",
                load: function(response){
                    var dest = dojo.byId(target_id);
                    dest.innerHTML = response;
                }
            });
        }
    </script>
    
    <a name="markers-navi" />
    <ul id="apps-markers-navi">
        <li>Choose ${marker_type}:</li>
        <li py:for="l in map(chr, range(65, 91))">
            <a href="#markers-navi" onclick="filter_markers('^${l}');switch_navi(this);return false;">${l}</a>
        </li>
        <li>
            Filter: <input id="apps-marker-filter" onchange="filter_markers(this.value);switch_navi(this);" size="10" value="" />
        </li>
    </ul>

    <div class="navi-frame">
    <ul id="apps-marker-list">
        <li py:for="m in markers" id="marker-${m.name.lower()}" style="display: none;">
            <a href="#markers-navi" onclick="load_apps('${m.name}', 'apps-by-marker-content');switch_navi(this); return false;">${m.name}</a>
        </li>
    </ul>
    <hr style="width: 100%; display: inline-block; border: 0;" />
    </div>
    <div id="apps-by-marker-content">
    </div>
  </div>
</html>
