================
Fedora PackageDB
================

:Author: Toshio Kuratomi
:Contact: toshio@fedoraproject.org
:Date: Friday, 27 April, 2008
:Version: 0.3.3

The `PackageDB` keeps track of package ownership within Fedora.

.. contents::

-------
Project
-------

The `PackageDB` was started in January of 2007 to remove some of the hurdles
that made it more time consuming to maintain packages in Fedora after CVS
acls were introduced.  The intial goal was to take information about who owned,
comaintained, and was allowed to commit changes to a package and put it in a
database where owners could edit it.

The system began to be used by cvsadmins in July of 2007, and was opened for
general use in September.  At present it allows general users to manage the
ownership of packages and allows admins to add new packages or change things
when the owner is unresponsive.  A webUI is open for everyone and a simplistic
commandline client works for admin requests.

.. _`PackageDB`: https://fedorahosted.org/packagedb

Future goals
============

We're trying to manage our Roadmap_ of new features in trac.  So far it's
working out well.  If you have a new feature request, please open a
`trac ticket`_ and we'll add it to the schedule to be worked on.

.. _`Roadmap`: https://fedorahosted.org/packagedb/roadmap
.. _`trac ticket`: https://fedorahosted.org/packagedb/report/3

------------
Installation
------------

Although it's not working yet, the goal is to be able to run::

  python setup.py build
  python setup.py install --root ${path to installation}

and have a working installation.

Running from a Checkout
=======================

If you want to run from a checkout, you can perform the following commands::

Install Prerequisites
~~~~~~~~~~~~~~~~~~~~~
::
  yum -y install python-genshi TurboGears python-turbojson postgresql-server \
    python-TurboMail python-bugzilla python-fedora python-psycopg2 \
    python-sqlalchemy python-feedparser

Get and Build the Source
~~~~~~~~~~~~~~~~~~~~~~~~
::
  bzr branch bzr://bzr.fedorahosted.org/bzr/packagedb/fedora-packagedb-devel
  cd fedora-packagedb-devel
  python setup.py egg_info
  python setup.py build --install-conf=`pwd` --install-data=`pwd`

Setup the Database
~~~~~~~~~~~~~~~~~~
Make sure postgres is set to allow connections over tcp/ip using password
authentication.  edit /var/lib/pgsql/data/pg_hba.conf.  You might find a line
like this::

  host	all 	all	127.0.0.1/32	ident sameuser

Instead of that line, you need one that looks like this::

  host	all	all	127.0.0.1/32	md5

Create the postgres users that can access the database.  Note that the pkgdb
web interface will use the pkgdbadmin user.  Other scripts which only read from
the database can use the pkgdbreadonly user to read information only::

  sudo /etc/init.d/postgresql start
  sudo -u postgres createuser -SDRPE pkgdbadmin
  sudo -u postgres createuser -SDRPE pkgdbreadonly

Note:: If you don't have sudo, you can use su - instead::

  su -
  /etc/init.d/postgresql start
  su - postgres
  createuser -SDRPE pkgdbadmin
  createuser -SDRPE pkgdbreadonly

Get some test data and import it into the database.  You want to grab the most
recent dump from http://fedorahosted.org/releases/p/a/packagedb like this::
  wget https://fedorahosted.org/releases/p/a/packagedb/pkgdb-20081031.dump.bz2
  bzcat pkgdb-20081031.dump.bz2 | sudo -u postgres psql

Your postgres server is now all set.

Start the Server
~~~~~~~~~~~~~~~~
First copy the fas.cfg.sample file to fas.cfg.  Next, edit fas.cfg to configure
the server to see your database.  You'll need to set fas.username to a
username (your Fedora Account System username will work), fas.password (if you
use your username, your password will work), and sqlalchemy.dburi.  The dburi
line will be something like this::

  sqlalchemy.dburi="postgres://pkgdbadmin:testpassword@localhost/pkgdb"

Then start the server::

  python start-pkgdb
